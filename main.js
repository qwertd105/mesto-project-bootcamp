(()=>{"use strict";var e={formSelector:".popup__form",inputSelector:".popup__form-text-input",submitButtonSelector:".popup__form-submit-button",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__form-text-input_type_error",errorClass:"popup__form-error_active"},t=document.querySelector(".profile__edit-button"),o=document.querySelector(".profile__add-button"),n=document.querySelector(".profile__avatar-editor"),r=document.querySelector(".popup_viewer"),c=document.querySelector(".popup_form_edit"),a=document.querySelector(".popup_form_add"),u=document.querySelector(".popup_avatar"),i=a.querySelectorAll(e.inputSelector),s=a.querySelector(e.submitButtonSelector),l=c.querySelectorAll(e.inputSelector),p=c.querySelector(e.submitButtonSelector),d=u.querySelectorAll(e.inputSelector),f=u.querySelector(e.submitButtonSelector),m=c.querySelector(".popup__form"),_=a.querySelector(".popup__form"),v=u.querySelector(".popup__form"),h=document.querySelectorAll(".popup__close-button"),y=document.querySelectorAll(".popup"),S=document.querySelector(".profile__name"),q=document.querySelector(".profile__profession"),b=document.querySelector(".profile__avatar"),k=document.querySelector(".places"),g=r.querySelector(".popup__image"),E=r.querySelector(".popup__description"),L=c.querySelector('.popup__form-text-input[name="name"]'),C=c.querySelector('.popup__form-text-input[name="profession"]'),x=u.querySelector(".popup__form-text-input"),j=a.querySelector('.popup__form-text-input[name="place-name"]'),A=a.querySelector('.popup__form-text-input[name="photo"]');function P(e){"Escape"===e.key&&B(document.querySelector(".popup_opened"))}function B(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",P)}function U(e){e.classList.add("popup_opened"),document.addEventListener("keydown",P)}function T(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(Array.from(e))?(t.classList.remove(o),t.disabled=!1):(t.classList.add(o),t.disabled=!0)}var N,w,O={baseUrl:"https://nomoreparties.co/v1/exp-mipt-fbc-1",headers:{authorization:"93861ead-2876-4823-8ff1-f57f368682cc","Content-Type":"application/json"}};function D(e,t){e.value=t?"Сохранение...":"Сохранить"}function J(e,t,o,n,c,a){var u=function(e,t,o,n,c,a){var u=document.querySelector("#card-template").content.cloneNode(!0),i=u.querySelector(".place__image");u.querySelector(".place__title").textContent=e,i.src=t,i.alt=e,console.log(o);var s=u.querySelector(".place__like-counter");s.textContent=o.length;var l=u.querySelector(".place__like-button");o.some((function(e){return e._id===a}))&&l.classList.add("place__like-button_active"),l.addEventListener("click",(function(e){var t;Array.from(e.target.classList).includes("place__like-button_active")?(t=c,fetch("".concat(O.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(){e.target.classList.remove("place__like-button_active"),s.textContent=String(Number(s.textContent)-1)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(O.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))}(c).then((function(){e.target.classList.add("place__like-button_active"),s.textContent=String(Number(s.textContent)+1)})).catch((function(e){console.log(e)}))}));var p=u.querySelector(".place__trash-button");return p.addEventListener("click",(function(e){console.log("я нажался");var t,o=e.target.closest(".place");(t=c,fetch("".concat(O.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(e){o.remove()})).catch((function(e){console.log(e)}))})),n||p.remove(),i.addEventListener("click",(function(o){g.src=t,g.alt=e,E.textContent=e,U(r)})),u}(e,t,o,n,c,a);k.prepend(u)}n.addEventListener("click",(function(t){T(d,f,e.inactiveButtonClass),U(u)})),o.addEventListener("click",(function(t){T(i,s,e.inactiveButtonClass),U(a)})),t.addEventListener("click",(function(t){L.value=S.textContent,C.value=q.textContent,T(l,p,e.inactiveButtonClass),U(c)})),function(e){e.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return B(t)}))}))}(h),N=y,Array.from(N).forEach((function(e){e.addEventListener("click",(function(t){t.target===e&&B(e),t.stopPropagation()}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()}));var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);T(o,n,e.inactiveButtonClass),o.forEach((function(r){r.addEventListener("input",(function(c){T(o,n,e.inactiveButtonClass),r.validity.valid?function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o),r.classList.remove(n),r.textContent=""}(t,r,e.inputErrorClass,e.errorClass):function(e,t,o,n,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n),c.textContent=o,c.classList.add(r)}(t,r,r.validationMessage,e.inputErrorClass,e.errorClass)}))}))}))}(e),fetch("".concat(O.baseUrl,"/users/me"),{headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){console.log(e.avatar),b.src=e.avatar,w=e})).catch((function(e){console.log(e)})),fetch("".concat(O.baseUrl,"/cards"),{headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){console.log(e[0]);var t=!1;e.forEach((function(e){t=e.owner._id===w._id,J(e.name,e.link,e.likes,t,e._id,w._id)}))})).catch((function(e){console.log(e)})),m.addEventListener("submit",(function(e){var t,o;D(p,!0),(t=L.value,o=C.value,fetch("".concat(O.baseUrl,"/users/me"),{method:"PATCH",headers:O.headers,body:JSON.stringify({name:t,about:o})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(e){!function(e,t){S.textContent=e,q.textContent=t}(e.name,e.about),B(c)})).catch((function(e){console.log(e)})).finally((function(){D(p,!1)}))})),_.addEventListener("submit",(function(e){var t,o;D(s,!0),(t=j.value,o=A.value,fetch("".concat(O.baseUrl,"/cards"),{method:"POST",headers:O.headers,body:JSON.stringify({name:t,link:o})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(t){console.log(t),J(t.name,t.link,t.likes,!0,t._id,w._id),B(a),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){D(s,!1)}))})),v.addEventListener("submit",(function(e){var t;D(f,!0),(t=x.value,fetch("".concat(O.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:O.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))).then((function(e){console.log(e),function(e){b.src=e}(e.avatar),B(u)})).catch((function(e){console.log(e)})).finally((function(){D(f,!1)}))}))})();